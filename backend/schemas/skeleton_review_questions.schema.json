{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "schema://legalagi/skeleton_review_questions/1.0.0",
  "title": "Skeleton Review Questions (Universal UX)",
  "type": "object",
  "additionalProperties": false,
  "required": ["review_id", "iteration", "questions"],
  "properties": {
    "review_id": { "type": "string", "minLength": 6 },
    "iteration": { "type": "integer", "minimum": 0, "maximum": 5 },
    "questions": {
      "type": "array",
      "minItems": 1,
      "maxItems": 12,
      "items": { "$ref": "#/$defs/Question" }
    }
  },
  "$defs": {
    "Question": {
      "type": "object",
      "additionalProperties": false,
      "required": ["question_id", "title", "ux", "binding", "priority"],
      "properties": {
        "question_id": { "type": "string", "minLength": 4 },
        "title": { "type": "string", "minLength": 5 },
        "description": { "type": "string" },
        "priority": { "type": "integer", "minimum": 1, "maximum": 100 },
        "required": { "type": "boolean", "default": false },
        "ux": { "$ref": "#/$defs/UXSpec" },
        "binding": { "$ref": "#/$defs/Binding" },
        "constraints": { "$ref": "#/$defs/Constraints" },
        "why_this_matters": {
          "type": "string",
          "description": "1–2 sentences: why user should decide this now."
        }
      }
    },
    "UXSpec": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["checkbox_group", "radio_group", "text_input", "number_input", "multi_text"]
        },
        "options": {
          "type": "array",
          "items": { "$ref": "#/$defs/Option" },
          "minItems": 2
        },
        "placeholder": { "type": "string" },
        "fields": {
          "type": "array",
          "description": "Used only for multi_text. Defines multiple input fields.",
          "items": { "$ref": "#/$defs/InputField" },
          "minItems": 1,
          "maxItems": 10
        }
      },
      "allOf": [
        {
          "if": { "properties": { "type": { "enum": ["checkbox_group", "radio_group"] } } },
          "then": { "required": ["options"] }
        },
        {
          "if": { "properties": { "type": { "const": "multi_text" } } },
          "then": { "required": ["fields"] }
        }
      ],
      "additionalProperties": true
    },
    "Option": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "label", "value", "impact"],
      "properties": {
        "id": { "type": "string", "minLength": 2 },
        "label": { "type": "string", "minLength": 1 },
        "value": {
          "description": "Value sent back as answer; usually string/boolean.",
          "type": ["string", "number", "boolean"]
        },
        "impact": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/ImpactOp" }
        }
      },
      "additionalProperties": true
    },
    "InputField": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "label", "bind_to_domain_path", "input_type"],
      "properties": {
        "id": { "type": "string", "minLength": 2 },
        "label": { "type": "string", "minLength": 1 },
        "input_type": { "type": "string", "enum": ["text", "number"] },
        "placeholder": { "type": "string" },
        "bind_to_domain_path": {
          "type": "string",
          "description": "JSON pointer path into state.domain where the value should be written."
        },
        "required": { "type": "boolean", "default": false }
      },
      "additionalProperties": true
    },
    "Binding": {
      "type": "object",
      "additionalProperties": false,
      "required": ["node_ids"],
      "properties": {
        "node_ids": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1
        },
        "bind_to_domain_path": {
          "type": "string",
          "description": "For text_input/number_input (single field) – where to write value in state.domain."
        }
      },
      "additionalProperties": true
    },
    "Constraints": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "min": { "type": "number" },
        "max": { "type": "number" },
        "max_length": { "type": "integer", "minimum": 1 },
        "pattern": { "type": "string" }
      },
      "additionalProperties": true
    },
    "ImpactOp": {
      "type": "object",
      "additionalProperties": false,
      "required": ["op"],
      "properties": {
        "op": {
          "type": "string",
          "enum": [
            "set_node_status",
            "select_variant",
            "set_domain_value",
            "add_issue",
            "resolve_issue"
          ]
        },
        "node_id": { "type": "string" },
        "status": { "type": "string", "enum": ["active", "omitted"] },
        "variant_id": { "type": "string" },
        "path": {
          "type": "string",
          "description": "JSON pointer into state.domain for set_domain_value."
        },
        "value": {},
        "issue_id": { "type": "string" },
        "issue_payload": {
          "type": "object",
          "additionalProperties": true,
          "description": "Free-form issue object; must be compatible with your Issue schema."
        }
      },
      "allOf": [
        {
          "if": { "properties": { "op": { "const": "set_node_status" } } },
          "then": { "required": ["node_id", "status"] }
        },
        {
          "if": { "properties": { "op": { "const": "select_variant" } } },
          "then": { "required": ["node_id", "variant_id"] }
        },
        {
          "if": { "properties": { "op": { "const": "set_domain_value" } } },
          "then": { "required": ["path", "value"] }
        },
        {
          "if": { "properties": { "op": { "const": "add_issue" } } },
          "then": { "required": ["issue_payload"] }
        },
        {
          "if": { "properties": { "op": { "const": "resolve_issue" } } },
          "then": { "required": ["issue_id"] }
        }
      ],
      "additionalProperties": true
    }
  }
}

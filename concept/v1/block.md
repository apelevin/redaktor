

# **LLM как онлайн-планировщик блоков (в рантайме)**

## *(Концепция для реализации диалога с уточняющими вопросами)*

В право(редактор) весь процесс уточнения данных перед созданием юридического документа управляется **одним центральным механизмом — LLM-планировщиком блоков**.
Этот планировщик работает *онлайн*, то есть принимает решения заново после каждого ответа пользователя.

---

# **1. Основная идея**

LLM не получает заранее фиксированную структуру документа.
Вместо этого после каждого нового фрагмента контекста он:

1. **Оценивает текущую ситуацию** (что уже известно).
2. **Строит список смысловых блоков**, которые нужны для данного договора.
3. **Выделяет минимально необходимый блок, который нужно уточнить следующим**.
4. **Формирует конкретный вопрос, который максимально эффективно соберёт недостающую информацию**.

Таким образом, LLM выступает как “юрист-планировщик”, который в реальном времени решает:

* какие блоки должны быть в договоре,
* какие блоки важнее,
* какие уже заполнены,
* какие ещё нужно уточнить,
* какие можно пропустить.

---

# **2. Что такое “блок” для LLM-планировщика**

LLM оперирует следующей абстракцией:

> **Блок — это смысловая область договора**, которую нужно закрыть минимальным набором данных, чтобы потом корректно сгенерировать юридическую формулировку.

Примеры блоков, которые LLM может динамически создать (это не фиксированный список):

* Стороны и идентификация
* Предмет (что делаем / что передаем)
* Стоимость и порядок оплаты
* Сроки
* Интеллектуальные права
* Ответственность
* Персональные данные
* Расторжение
* Конфиденциальность
* Технические параметры
* Гарантии
* Подписание / форма договора
* Уведомления
* Hosting / домен / доступы
* Маркетинг и реклама
* Прочие условия

LLM в любой момент может:

* создать новый блок,
* удалить неактуальный,
* изменить важность,
* изменить порядок появления,
* объединить два блока в один,
* пометить блок как “достаточно заполненный”.

---

# **3. Задачи LLM после каждого ответа пользователя**

После каждого шага LLM выполняет четыре задачи:

---

## **Задача 1. Пересборка структуры блоков**

LLM получает:

* текущий контекст (JSON всех полученных ответов),
* историю вопросов,
* краткое описание задачи (первый ввод пользователя),
* тип документа (если указан).

LLM определяет:

1. **Список актуальных блоков для данного сценария**
2. **Важность каждого блока**: must / recommended / optional
3. **Степень заполненности каждого блока**
4. **Наличие пробелов, рисков или противоречий**

Выход: структура блоков в JSON.

---

## **Задача 2. Определение, нужно ли продолжать диалог**

LLM решает:

* достаточно ли данных для генерации договора (все must-блоки закрыты),
* или требуется ещё минимум один вопрос для закрытия критичного блока.

Если must-блоков нет → планировщик переходит к этапу “предложить завершение”.

---

## **Задача 3. Выбор следующего блока для уточнения**

Если диалог продолжается, LLM выбирает:

* какой блок сейчас самый значимый,
* какой ещё неполный,
* какой необходимо уточнить, чтобы не рисковать юридическими ошибками.

Критерии выбора:

1. must-блоки всегда выше по приоритету;
2. внутри must-блоков — наибольший “риск недоопределённости”;
3. если must-закрыты → смотрим recommended (только если пользователь выразил желание уточнять дальше).

---

## **Задача 4. Генерация следующего вопроса**

LLM формирует **один конкретный вопрос**, который:

* максимально сокращает неопределённость в выбранном блоке,
* собирает ровно то, чего не хватает,
* не повторяет ранее заданные вопросы,
* учитывает все предыдущие ответы.

Формат вопроса может быть:

* открытый текст,
* одиночный выбор,
* мульти-выбор,
* вопрос с подсказками (hints),
* уточняющий, если ответ был неполным.

---

# **4. Условие остановки**

Планировщик автоматически считает, можно ли переходить к созданию договора.

### Остановки бывают двух типов:

### **Автоматическая остановка**

Если все must-блоки закрыты:

LLM говорит:

> “Я собрал все обязательные данные и могу сформировать договор.”

И предлагает пользователю два варианта:

1. Создать договор сейчас
2. Уточнить ещё несколько рекомендованных моментов

### **Остановка по выбору пользователя**

Пользователь всегда может нажать кнопку:

> **“Сформировать договор”**

Если must-блоки закрыты → начинаем генерацию.
Если нет → LLM говорит, каких данных не хватает.

---

# **5. Основной цикл работы онлайн-планировщика**

На каждом шаге выполняется:

```
context ← ответы пользователя
blocks ← LLM.analyze(context)
if blocks.must_completed: offer_finish()
next_block ← LLM.selectBlock(blocks)
next_question ← LLM.generateQuestion(next_block, context)
ask(next_question)
```

Этот цикл повторяется до момента окончания.

---

# **6. Почему такой подход работает**

### ✔ Абсолютная гибкость

Документ может быть любым: договор услуг, поставка, маркетинг, сайт, лицензия — даже комбинация.

### ✔ Нулевое требование к заранее созданным схемам

Можно запускаться “с пустым хранилищем”.

### ✔ Контекстная адаптивность

Ответы пользователя могут радикально поменять структуру блоков.

### ✔ Минимальное количество вопросов

LLM задаёт только то, что действительно нужно *в этом конкретном сценарии*.

### ✔ Юридическая полнота

Блоки must = минимальный юридический набор, определённый самим LLM.

### ✔ Естественный UX

Диалог похож на разговор с живым юристом.

---


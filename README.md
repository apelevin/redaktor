# AI Document Editor

Редактор документов с искусственным интеллектом, реализующий пайплайн для создания юридических документов.

## Возможности

- Интерактивный сбор контекста через чат
- Генерация структуры документа (skeleton)
- Поиск готовых формулировок в Pinecone (RAG)
- Генерация клауз через OpenAI
- Редактирование документа в реальном времени
- Разделенный интерфейс: редактор слева, чат справа

## Технологии

- **Next.js 14** - React фреймворк с App Router
- **TypeScript** - типизация
- **Tailwind CSS** - стилизация
- **Zustand** - управление состоянием
- **Pinecone** - векторная база данных для RAG
- **OpenAI GPT-5.1** - генерация текста с reasoning capabilities

## Установка

1. Установите зависимости:

```bash
npm install
```

2. Создайте файл `.env.local` на основе `.env.example`:

```bash
cp .env.example .env.local
```

3. Заполните переменные окружения в `.env.local`:

```env
PINECONE_API_KEY=your_pinecone_api_key
PINECONE_ENVIRONMENT=your_environment
PINECONE_INSTRUCTIONS_INDEX=editor  # или имя вашего индекса
PINECONE_CLAUSES_INDEX=editor      # или имя вашего индекса
OPENAI_API_KEY=your_openai_api_key
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

**Примечание:** Если у вас один индекс (например, `editor`), используйте его для обоих переменных `PINECONE_INSTRUCTIONS_INDEX` и `PINECONE_CLAUSES_INDEX`.

### Конфигурация моделей OpenAI

По умолчанию используются следующие модели для разных шагов:

- **Генерация вопросов**: `gpt-5-mini` (оптимизация стоимости)
- **Проверка завершенности контекста**: `gpt-5-nano` (высокая пропускная способность)
- **Генерация skeleton**: `gpt-5.1` (сложная структурированная задача)
- **Генерация клауз**: `gpt-5.1` (требует юридической точности)

Вы можете переопределить модели через переменные окружения:

```env
OPENAI_MODEL_QUESTION_GENERATION=gpt-5-mini
OPENAI_MODEL_CONTEXT_COMPLETION=gpt-5-nano
OPENAI_MODEL_SKELETON_GENERATION=gpt-5.1
OPENAI_MODEL_CLAUSE_GENERATION=gpt-5.1
```

4. Запустите dev сервер:

```bash
npm run dev
```

Откройте [http://localhost:3000](http://localhost:3000) в браузере.

## Настройка Pinecone

Перед использованием необходимо создать индексы в Pinecone:

1. **Индекс `instructions`** - для хранения инструкций по типам документов
   - Размерность векторов: **1024** (совместимо с llama-text-embed-v2 и text-embedding-3-small)
   - Модель эмбеддингов: `text-embedding-3-small` (OpenAI) с параметром `dimensions: 1024`
   - Тип: Dense
   - Capacity mode: On-demand

2. **Индекс `clauses`** - для хранения клауз и формулировок
   - Размерность векторов: **1024** (совместимо с llama-text-embed-v2 и text-embedding-3-small)
   - Модель эмбеддингов: `text-embedding-3-small` (OpenAI) с параметром `dimensions: 1024`
   - Тип: Dense
   - Capacity mode: On-demand

**Использование существующего индекса:**

Если у вас уже есть индекс (например, `editor`), вы можете использовать его для обоих типов данных, установив в `.env.local`:

```env
PINECONE_INSTRUCTIONS_INDEX=editor
PINECONE_CLAUSES_INDEX=editor
```

Или создайте отдельные индексы для инструкций и клауз.

**Важно:** Индексы должны быть созданы с размерностью **1024**. Код использует `text-embedding-3-small` с параметром `dimensions: 1024` для совместимости с существующими индексами.

## Структура проекта

```
Editor/
├── app/                    # Next.js App Router
│   ├── api/pipeline/       # API routes для пайплайна
│   ├── components/         # React компоненты
│   └── page.tsx           # Главная страница
├── lib/
│   ├── pinecone/          # Интеграция с Pinecone
│   ├── openai/            # Интеграция с OpenAI
│   ├── pipeline/          # Типы и состояние
│   └── utils/             # Утилиты
├── prompts/               # Промпты в markdown файлах
└── types/                 # TypeScript типы
```

## Использование

1. Нажмите "Новый документ" в правой панели
2. Введите тип документа (например: "договор поставки")
3. Отвечайте на вопросы в чате для сбора контекста
4. После сбора контекста система автоматически:
   - Создаст структуру документа
   - Найдет или сгенерирует пункты
5. Редактируйте документ в левой панели при необходимости
6. Нажмите "Сохранить документ" для добавления в базу знаний (RAG)

## Сохранение документов

Система поддерживает самообучение через сохранение созданных документов:

- При сохранении документа его **skeleton** сохраняется как инструкция в индекс `instructions`
- Каждая **клауза** сохраняется отдельно в индекс `clauses`
- Все записи автоматически помечаются как `approved: true` и могут быть использованы в будущих документах
- Сохраненные документы используются для поиска через RAG перед генерацией через LLM

Это позволяет системе улучшаться с каждым сохраненным документом.

## Промпты

Все промпты хранятся в папке `prompts/` в формате markdown:
- `question-generation.md` - генерация вопросов
- `context-completion.md` - проверка завершенности контекста
- `skeleton-generation.md` - генерация структуры
- `clause-generation.md` - генерация клауз

Промпты используют простую систему подстановки переменных: `{{variable_name}}`

## Разработка

```bash
# Запуск dev сервера
npm run dev

# Сборка для production
npm run build

# Запуск production сборки
npm start

# Линтинг
npm run lint
```

## Примечания

- MVP версия не включает проверку когерентности (Блок 7 из пайплайна)
- Временный RAG по документу не реализован в MVP
- Система использует модель `text-embedding-3-small` для создания эмбеддингов
- Пороги релевантности: `INSTRUCTION_THRESHOLD = 0.75`, `CLAUSE_THRESHOLD = 0.75`


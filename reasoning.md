## Ключевое уточнение (одним абзацем)

> **Уровень рассуждения — это не внутренний параметр агента,
> а явное пользовательское решение, принимаемое через HITL и влияющее на весь пайплайн.**
>
> Агент **не имеет права** сам выбрать уровень рассуждения.
> Если он не задан явно — агент обязан запросить его у пользователя.

---

## 1. Уровень рассуждения как first-class decision

### 1.1. Что такое `ReasoningLevel` на самом деле

`ReasoningLevel` — это **контракт между пользователем и агентом** о том:

* какой **объём** документа допустим,
* какая **глубина юридической проработки** ожидается,
* насколько допустима **юридическая перестраховка**,
* сколько **опциональных защит** включать.

Это **не стиль** и **не техническая настройка**, а продуктовый выбор.

```ts
type ReasoningLevel = "basic" | "standard" | "professional";
```

---

## 2. Где именно пользователь выбирает уровень рассуждения

### 2.1. Момент выбора (очень важно)

**Выбор уровня рассуждения происходит в самом начале пайплайна**
на шаге `mission_interpreter`.

#### Правило:

* Если пользователь **явно указал** уровень в тексте запроса → агент использует его.
* Если **не указал** → агент **обязан остановиться и спросить**.

---

### 2.2. HITL-вопрос уровня рассуждения (чат справа)

Это **первый системный HITL-вопрос** в PRO-архитектуре.

```ts
UserQuestion {
  id: "reasoning_level",
  type: "single_choice",
  title: "Уровень проработки документа",
  text: "Выберите, насколько подробно и глубоко нужно проработать юридический документ.",
  options: [
    {
      id: "basic",
      label: "Базовый",
      legalEffect: "Короткий документ (1–2 страницы), только обязательные условия",
      isRecommended: false,
      riskLevel: "medium"
    },
    {
      id: "standard",
      label: "Стандартный",
      legalEffect: "Рыночный уровень (3–5 страниц), сбалансированные защиты",
      isRecommended: true,
      riskLevel: "low"
    },
    {
      id: "professional",
      label: "Профессиональный",
      legalEffect: "Максимально подробный документ, BigLaw-уровень, edge-cases",
      isRecommended: false,
      riskLevel: "low"
    }
  ],
  decisionKey: "reasoning_level",
  required: true,
  legalImpact: "Уровень влияет на объём, детализацию и количество защитных положений в договоре."
}
```

❗ **Пока пользователь не выбрал уровень — пайплайн не продолжается.**

---

## 3. Как выбор сохраняется и используется

### 3.1. Сохранение как решение пользователя

После ответа пользователя:

```ts
decisions["reasoning_level"] = {
  key: "reasoning_level",
  value: "standard", // basic | standard | professional
  source: "user",
  timestamp: "2025-01-01T12:00:00Z"
};
```

И одновременно:

```ts
mission.reasoningLevel = decisions["reasoning_level"].value;
state.sizePolicy = SIZE_POLICY[mission.reasoningLevel];
```

---

## 4. Как `ReasoningLevel` реально влияет на пайплайн (не декларативно)

Вот **жёсткое правило PRO-архитектуры**:

> Ни один шаг пайплайна не имеет права игнорировать `sizePolicy`.

---

### 4.1. `issue_spotter`

```text
basic:
- только обязательные issues
- без редких/экзотических рисков

standard:
- обязательные + типовые рыночные

professional:
- обязательные + типовые + edge-cases + защитные конструкции
```

---

### 4.2. `skeleton_generator`

```text
basic:
- укрупнённые секции
- меньше разделов (объединение)

professional:
- детальная декомпозиция
- отдельные секции под SLA, PD, indemnities, audit и т.п.
```

---

### 4.3. `clause_requirements_generator`

```text
basic:
- короткий список requiredElements
- минимум условий

professional:
- requiredElements + recommendedElements
- отдельные подпункты под исключения, оговорки, carve-outs
```

---

### 4.4. `clause_generator`

```text
basic:
- короткие формулировки
- без каскадных условий

professional:
- длинные многоуровневые пункты
- условия + исключения + оговорки
```

---

### 4.5. `document_linter`

```text
basic:
- только hard checks (пусто / нет обязательного блока)

professional:
- hard checks + soft legal review:
  - рыночность
  - риск-позиция
  - потенциальная уязвимость формулировок
```

---

## 5. Важное архитектурное следствие

### 5.1. Уровень рассуждения **не меняется автоматически**

* Агент **не повышает** уровень сам (“я подумал и сделал professional”).
* Единственный способ изменить уровень:

  * пользователь вручную меняет его в чате.

Допустимый UX:

> “Хотите углубить документ до профессионального уровня и включить дополнительные защиты?”
> `[Да, повысить уровень] [Нет, оставить как есть]`

Это снова `need_user_input`.

---

## 6. Исправленная формулировка для архитектуры (можно вставить)

Вот короткий абзац, который можно прямо добавить в `ARCHITECTURE.md`:

> **Reasoning Level (basic / standard / professional) является обязательным пользовательским решением.**
>
> Если уровень рассуждения не указан явно, агент обязан запросить его у пользователя через HITL и не имеет права продолжать пайплайн без ответа.
>
> Выбранный уровень управляет:
>
> * целевым объёмом документа,
> * количеством обязательных и опциональных блоков,
> * глубиной юридической проработки,
> * строгостью финального линта.
>
> Ни один шаг пайплайна не может игнорировать `sizePolicy`, выведенную из `ReasoningLevel`.

---

## 7. Почему это критично правильно

С этой логикой:

* пользователь **контролирует объём и “юридическую тяжесть”** документа,
* агент перестаёт быть “умнее пользователя”,
* ожидания совпадают с результатом,
* ты можешь честно сказать:

  > “basic ≠ плохой документ,
  > professional ≠ обязательный по умолчанию”.

Это очень сильное продуктовое решение.

---

